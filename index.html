<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Road Trip Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Caveat:wght@600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root {
      --sunset-orange: #FF6B35;
      --desert-sand: #F7931E;
      --sky-blue: #4ECDC4;
      --road-gray: #2C3E50;
      --vintage-cream: #FFF8E7;
      --map-green: #95C623;
      --night-blue: #1A1A2E;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Libre Baskerville', serif;
      background: linear-gradient(135deg, var(--vintage-cream) 0%, #FFE5B4 100%);
      color: var(--road-gray);
      min-height: 100vh;
      padding: 2rem;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.02) 2px, rgba(0,0,0,0.02) 4px);
      pointer-events: none;
      z-index: 1;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
      animation: slideDown 0.8s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-family: 'Bebas Neue', cursive;
      font-size: 5rem;
      color: var(--sunset-orange);
      text-shadow: 4px 4px 0px var(--desert-sand), 8px 8px 0px rgba(0,0,0,0.1);
      letter-spacing: 4px;
      margin-bottom: 0.5rem;
      line-height: 1;
    }

    .tagline {
      font-family: 'Caveat', cursive;
      font-size: 1.8rem;
      color: var(--road-gray);
      transform: rotate(-2deg);
      display: inline-block;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    .tagline:hover {
      background: rgba(255, 107, 53, 0.1);
      transform: rotate(-2deg) scale(1.05);
    }

    .controls {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
      border: 4px solid var(--sunset-orange);
      animation: fadeIn 1s ease-out 0.3s both;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .button-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    button {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.2rem;
      letter-spacing: 1px;
      padding: 0.8rem 1.8rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--sunset-orange), var(--desert-sand));
      color: white;
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--sky-blue), var(--map-green));
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #E74C3C, #C0392B);
      color: white;
    }

    .filter-section {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-section label {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.1rem;
      letter-spacing: 1px;
      color: var(--road-gray);
    }

    input[type="date"] {
      font-family: 'Libre Baskerville', serif;
      padding: 0.6rem 1rem;
      border: 3px solid var(--sky-blue);
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    input[type="date"]:focus {
      outline: none;
      border-color: var(--sunset-orange);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeInModal 0.3s ease-out;
      padding: 1rem;
    }

    @keyframes fadeInModal {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 2.5rem;
      border-radius: 20px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      border: 4px solid var(--sunset-orange);
      animation: slideUp 0.4s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-content h2 {
      font-family: 'Bebas Neue', cursive;
      font-size: 2.5rem;
      color: var(--sunset-orange);
      margin-bottom: 1.5rem;
      letter-spacing: 2px;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      font-family: 'Bebas Neue', cursive;
      font-size: 1.1rem;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
      color: var(--road-gray);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 3px solid var(--sky-blue);
      border-radius: 10px;
      font-family: 'Libre Baskerville', serif;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--sunset-orange);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .timeline {
      position: relative;
      animation: fadeIn 1s ease-out 0.6s both;
    }

    .day-section {
      margin-bottom: 3rem;
      animation: slideInLeft 0.6s ease-out both;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .day-header {
      font-family: 'Bebas Neue', cursive;
      font-size: 2.5rem;
      color: var(--road-gray);
      margin-bottom: 1.5rem;
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, var(--desert-sand), var(--sunset-orange));
      color: white;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      letter-spacing: 2px;
    }

    .activity-card {
      background: white;
      padding: 1.8rem;
      margin-bottom: 1.5rem;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      border-left: 8px solid var(--sky-blue);
      position: relative;
      transition: all 0.3s ease;
      animation: cardPop 0.5s ease-out both;
    }

    @keyframes cardPop {
      0% {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .activity-card:hover {
      transform: translateX(5px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.15);
    }

    .activity-card.driving {
      border-left-color: var(--sunset-orange);
    }

    .activity-card.eating {
      border-left-color: var(--map-green);
    }

    .activity-card.sleeping {
      border-left-color: var(--night-blue);
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    .activity-title {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.8rem;
      color: var(--road-gray);
      letter-spacing: 1px;
    }

    .activity-type {
      font-family: 'Caveat', cursive;
      font-size: 1.2rem;
      padding: 0.3rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      flex-shrink: 0;
    }

    .activity-type.driving {
      background: var(--sunset-orange);
      color: white;
    }

    .activity-type.eating {
      background: var(--map-green);
      color: white;
    }

    .activity-type.sleeping {
      background: var(--night-blue);
      color: white;
    }

    .activity-type.other {
      background: var(--sky-blue);
      color: white;
    }

    .activity-details {
      margin-bottom: 1rem;
      line-height: 1.8;
    }

    .activity-details p {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .activity-details strong {
      color: var(--sunset-orange);
      font-weight: 700;
    }

    .activity-time {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.3rem;
      color: var(--road-gray);
      letter-spacing: 1px;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .time-arrow {
      color: var(--sunset-orange);
    }

    .activity-actions {
      display: flex;
      gap: 0.8rem;
      margin-top: 1rem;
    }

    .activity-actions button {
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
    }

    .btn-small {
      padding: 0.4rem 1rem;
      font-size: 0.9rem;
    }

    .address-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--sky-blue);
      text-decoration: none;
      font-weight: 700;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: rgba(78, 205, 196, 0.1);
      margin-top: 0.5rem;
    }

    .address-link:hover {
      background: rgba(78, 205, 196, 0.2);
      transform: translateX(3px);
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      animation: fadeIn 1s ease-out;
    }

    .empty-state-icon {
      font-size: 5rem;
      margin-bottom: 1rem;
    }

    .empty-state h3 {
      font-family: 'Bebas Neue', cursive;
      font-size: 2rem;
      color: var(--road-gray);
      margin-bottom: 1rem;
      letter-spacing: 2px;
    }

    .empty-state p {
      color: #7f8c8d;
      font-size: 1.1rem;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .json-export {
      width: 100%;
      min-height: 200px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      padding: 1rem;
      border: 3px solid var(--sky-blue);
      border-radius: 10px;
      background: #f8f9fa;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 3rem;
      }

      .tagline {
        font-size: 1.3rem;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .activity-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      color: var(--road-gray);
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: rgba(0,0,0,0.1);
      transform: rotate(90deg);
    }

    .hamburger-menu {
      position: fixed;
      top: 2rem;
      right: 2rem;
      z-index: 100;
    }

    .map-menu {
      position: fixed;
      top: 2rem;
      left: 2rem;
      z-index: 100;
    }

    .map-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--sky-blue), var(--map-green));
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      padding: 0;
      font-size: 1.8rem;
    }

    .map-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    .hamburger-menu {
      position: fixed;
      top: 2rem;
      right: 2rem;
      z-index: 100;
    }

    .hamburger-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--sunset-orange), var(--desert-sand));
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      padding: 0;
    }

    .hamburger-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    .hamburger-btn span {
      width: 30px;
      height: 3px;
      background: white;
      border-radius: 3px;
      transition: all 0.3s ease;
    }

    .hamburger-btn.active span:nth-child(1) {
      transform: rotate(45deg) translate(8px, 8px);
    }

    .hamburger-btn.active span:nth-child(2) {
      opacity: 0;
    }

    .hamburger-btn.active span:nth-child(3) {
      transform: rotate(-45deg) translate(8px, -8px);
    }

    .menu-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      max-width: 90vw;
      height: 100vh;
      background: white;
      box-shadow: -5px 0 25px rgba(0,0,0,0.3);
      transition: right 0.4s ease;
      z-index: 99;
      padding: 6rem 2rem 2rem;
      overflow-y: auto;
    }

    .menu-panel.active {
      right: 0;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 98;
    }

    .menu-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .user-profile-section {
      margin-bottom: 2.5rem;
      padding-bottom: 2rem;
      border-bottom: 3px solid var(--desert-sand);
    }

    .user-profile-card {
      background: linear-gradient(135deg, var(--vintage-cream), #FFE5B4);
      padding: 1.5rem;
      border-radius: 15px;
      text-align: center;
      margin-bottom: 1rem;
    }

    .user-profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 4px solid var(--sunset-orange);
      margin: 0 auto 1rem;
      display: block;
    }

    .user-profile-name {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.5rem;
      color: var(--road-gray);
      letter-spacing: 1px;
      margin-bottom: 0.3rem;
    }

    .user-profile-email {
      font-size: 0.9rem;
      color: #7f8c8d;
    }

    .google-signin-btn {
      width: 100%;
      background: white;
      color: #444;
      border: 2px solid #ddd;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-family: 'Libre Baskerville', serif;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .google-signin-btn:hover {
      background: #f8f9fa;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }

    .google-icon {
      width: 20px;
      height: 20px;
    }

    .user-indicator {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-top: 1rem;
      padding: 0.8rem 1.5rem;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      animation: slideDown 0.8s ease-out 0.5s both;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--sunset-orange);
    }

    .user-indicator span {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.2rem;
      color: var(--road-gray);
      letter-spacing: 1px;
    }

    .menu-section {
      margin-bottom: 2.5rem;
    }

    .menu-section h3 {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.5rem;
      color: var(--sunset-orange);
      margin-bottom: 1rem;
      letter-spacing: 2px;
      border-bottom: 3px solid var(--desert-sand);
      padding-bottom: 0.5rem;
    }

    .menu-section button {
      width: 100%;
      margin-bottom: 0.8rem;
    }

    .notification {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1.2rem 2rem;
      border-radius: 15px;
      font-family: 'Bebas Neue', cursive;
      font-size: 1.2rem;
      letter-spacing: 1px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 10000;
      max-width: 400px;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-success {
      background: linear-gradient(135deg, var(--map-green), var(--sky-blue));
      color: white;
    }

    .notification-error {
      background: linear-gradient(135deg, #E74C3C, #C0392B);
      color: white;
    }

    .notification-info {
      background: linear-gradient(135deg, var(--sky-blue), var(--desert-sand));
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ROAD TRIP</h1>
      <div class="tagline" onclick="editSubtitle()" id="subtitle" title="Click to edit">Plan Your Perfect Journey</div>
      <div id="userIndicator" class="user-indicator" style="display: none;">
        <img id="userAvatar" class="user-avatar" src="" alt="">
        <span id="userName"></span>
      </div>
    </header>

    <!-- Map View Button -->
    <div class="map-menu">
      <button class="map-btn" onclick="openMapView()" title="View on Map">
        üó∫Ô∏è
      </button>
    </div>

    <!-- Hamburger Menu -->
    <div class="hamburger-menu">
      <button class="hamburger-btn" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div class="menu-overlay" onclick="toggleMenu()"></div>
    <div class="menu-panel">
      <!-- User Profile Section -->
      <div class="user-profile-section">
        <div id="loggedOutView">
          <h3 style="font-family: 'Bebas Neue', cursive; font-size: 1.5rem; color: var(--sunset-orange); margin-bottom: 1rem; letter-spacing: 2px;">Account</h3>
          <div id="googleButtonContainer"></div>
          <button class="google-signin-btn" onclick="signInWithGoogle()" style="margin-top: 1rem;">
            <svg class="google-icon" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Sign in with Google
          </button>
        </div>

        <div id="loggedInView" style="display: none;">
          <h3 style="font-family: 'Bebas Neue', cursive; font-size: 1.5rem; color: var(--sunset-orange); margin-bottom: 1rem; letter-spacing: 2px;">Account</h3>
          <div class="user-profile-card">
            <img id="menuUserAvatar" class="user-profile-avatar" src="" alt="">
            <div class="user-profile-name" id="menuUserName"></div>
            <div class="user-profile-email" id="menuUserEmail"></div>
          </div>
          <button class="btn-danger" onclick="logout()" style="width: 100%;">Logout</button>
        </div>
      </div>

      <div class="menu-section">
        <h3>Add Activity</h3>
        <button class="btn-primary" onclick="openAddModal(); toggleMenu();">+ New Activity</button>
      </div>

      <div class="menu-section">
        <h3>Filter</h3>
        <label for="filterDate" style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Select Date:</label>
        <input type="date" id="filterDate" onchange="filterActivities()" style="width: 100%; margin-bottom: 0.8rem;">
        <button class="btn-secondary" onclick="clearFilter()">Show All Days</button>
      </div>

      <div class="menu-section">
        <h3>Tools</h3>
        <button class="btn-secondary" onclick="exportData(); toggleMenu();">Export Trip Data</button>
        <button class="btn-secondary" onclick="openImportModal(); toggleMenu();">Import Trip Data</button>
        <button class="btn-danger" onclick="clearAllData()">Clear All Activities</button>
      </div>
    </div>

    <div id="timeline" class="timeline"></div>
  </div>

  <!-- Add/Edit Activity Modal -->
  <div id="activityModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <h2 id="modalTitle">Add Activity</h2>
      <div id="activityForm">
        <div class="form-group">
          <label for="activityType">Activity Type</label>
          <select id="activityType" required>
            <option value="driving">üöó Driving</option>
            <option value="eating">üçΩÔ∏è Eating</option>
            <option value="sleeping">üõèÔ∏è Sleeping</option>
            <option value="other">üéØ Other</option>
          </select>
        </div>

        <div class="form-group">
          <label for="activityName">Activity Name</label>
          <input type="text" id="activityName" placeholder="e.g., Lunch at Joe's Diner" required>
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <input type="text" id="address" placeholder="e.g., 123 Main St, Springfield, IL" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="startDateTime">Start Date & Time</label>
            <input type="datetime-local" id="startDateTime" required>
          </div>

          <div class="form-group">
            <label for="duration">Duration (hours)</label>
            <input type="number" id="duration" step="0.25" min="0.25" placeholder="e.g., 1.5" required>
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" placeholder="Any special notes or details..."></textarea>
        </div>

        <div class="button-group">
          <button type="button" class="btn-primary" onclick="saveActivity()">Save Activity</button>
          <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeImportModal()">&times;</button>
      <h2>Import Trip Data</h2>
      <div class="form-group">
        <label for="importJSON">Paste JSON Data</label>
        <textarea id="importJSON" class="json-export" placeholder='{"activities": [...]}'></textarea>
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="importData()">Import</button>
        <button class="btn-secondary" onclick="closeImportModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeExportModal()">&times;</button>
      <h2>Export Trip Data</h2>
      <div class="form-group">
        <label for="exportJSON">Copy this JSON</label>
        <textarea id="exportJSON" class="json-export" readonly></textarea>
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="copyToClipboard()">Copy to Clipboard</button>
        <button class="btn-secondary" onclick="downloadJSON()">Download File</button>
        <button class="btn-secondary" onclick="closeExportModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    let activities = [];
    let editingId = null;
    let filterDate = null;
    let subtitle = 'Plan Your Perfect Journey';
    let currentUser = null;
    let googleClientId = '548418558127-oq09sbqgdslma396aukj2alh672qaona.apps.googleusercontent.com';

    // Simple JWT decoder (client-side only)
    function decodeJWT(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
      } catch (error) {
        console.error('Error decoding JWT:', error);
        return null;
      }
    }

    // Initialize Google Sign-In
    function initGoogleSignIn() {
      // Wait for script to load, with retry mechanism
      let attempts = 0;
      const maxAttempts = 10;
      
      const checkGoogleLoaded = setInterval(() => {
        attempts++;
        
        if (typeof google !== 'undefined' && google.accounts) {
          clearInterval(checkGoogleLoaded);
          
          google.accounts.id.initialize({
            client_id: googleClientId,
            callback: handleGoogleResponse,
            auto_select: false,
            cancel_on_tap_outside: true
          });
          
          // Render the button in the container
          renderGoogleButton();
          
        } else if (attempts >= maxAttempts) {
          clearInterval(checkGoogleLoaded);
          console.warn('Google Identity Services not loaded after multiple attempts.');
          showFallbackMessage();
        }
      }, 300);
    }

    // Render Google Sign-In button
    function renderGoogleButton() {
      const buttonContainer = document.getElementById('googleButtonContainer');
      if (buttonContainer && typeof google !== 'undefined') {
        google.accounts.id.renderButton(
          buttonContainer,
          {
            theme: 'outline',
            size: 'large',
            width: '100%',
            text: 'signin_with',
            shape: 'rectangular'
          }
        );
      }
    }

    // Show fallback message
    function showFallbackMessage() {
      const loggedOutView = document.getElementById('loggedOutView');
      if (loggedOutView && !currentUser) {
        loggedOutView.innerHTML = `
          <h3 style="font-family: 'Bebas Neue', cursive; font-size: 1.5rem; color: var(--sunset-orange); margin-bottom: 1rem; letter-spacing: 2px;">Account</h3>
          <div style="padding: 1rem; background: #fff3cd; border-radius: 10px; color: #856404; font-size: 0.9rem; margin-bottom: 1rem;">
            ‚ö†Ô∏è Google Sign-In is blocked by Content Security Policy in Claude artifacts.
          </div>
          <div style="padding: 1rem; background: #d1ecf1; border-radius: 10px; color: #0c5460; font-size: 0.85rem;">
            <strong>üí° Workaround:</strong> Download this HTML file and open it in your browser, or host it on your own domain to enable Google Sign-In.
          </div>
        `;
      }
    }

    // Handle Google Sign-In response
    function handleGoogleResponse(response) {
      const userData = decodeJWT(response.credential);
      if (userData) {
        currentUser = {
          id: userData.sub,
          name: userData.name,
          email: userData.email,
          picture: userData.picture,
          token: response.credential
        };
        
        // Save to localStorage
        localStorage.setItem('roadtripUser', JSON.stringify(currentUser));
        
        updateUIForUser();
        showNotification(`Welcome, ${currentUser.name}!`, 'success');
      }
    }

    // Sign in with Google
    function signInWithGoogle() {
      if (typeof google !== 'undefined' && google.accounts) {
        google.accounts.id.prompt();
      } else {
        showNotification('Google Sign-In is not available in this environment', 'error');
      }
    }

    // Logout
    function logout() {
      currentUser = null;
      localStorage.removeItem('roadtripUser');
      updateUIForUser();
      showNotification('Logged out successfully', 'success');
      toggleMenu();
    }

    // Update UI based on user state
    function updateUIForUser() {
      const loggedInView = document.getElementById('loggedInView');
      const loggedOutView = document.getElementById('loggedOutView');
      const userIndicator = document.getElementById('userIndicator');
      
      if (currentUser) {
        // Show logged in view
        loggedInView.style.display = 'block';
        loggedOutView.style.display = 'none';
        
        // Update menu profile
        document.getElementById('menuUserAvatar').src = currentUser.picture;
        document.getElementById('menuUserName').textContent = currentUser.name;
        document.getElementById('menuUserEmail').textContent = currentUser.email;
        
        // Update header indicator
        userIndicator.style.display = 'flex';
        document.getElementById('userAvatar').src = currentUser.picture;
        document.getElementById('userName').textContent = currentUser.name;
      } else {
        // Show logged out view
        loggedInView.style.display = 'none';
        loggedOutView.style.display = 'block';
        userIndicator.style.display = 'none';
      }
    }

    // Load user from localStorage
    function loadUser() {
      const savedUser = localStorage.getItem('roadtripUser');
      if (savedUser) {
        try {
          currentUser = JSON.parse(savedUser);
          updateUIForUser();
        } catch (error) {
          console.error('Error loading user:', error);
          localStorage.removeItem('roadtripUser');
        }
      }
    }

    // Toggle hamburger menu
    function toggleMenu() {
      const btn = document.querySelector('.hamburger-btn');
      const panel = document.querySelector('.menu-panel');
      const overlay = document.querySelector('.menu-overlay');
      
      btn.classList.toggle('active');
      panel.classList.toggle('active');
      overlay.classList.toggle('active');
    }

    // Load data from localStorage on startup
    function loadData() {
      const saved = localStorage.getItem('roadtripActivities');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          // Support both old format (just array) and new format (object with subtitle)
          if (Array.isArray(data)) {
            activities = data;
          } else {
            activities = data.activities || [];
            subtitle = data.subtitle || 'Plan Your Perfect Journey';
            document.getElementById('subtitle').textContent = subtitle;
          }
        } catch (e) {
          activities = [];
        }
      }
      renderTimeline();
    }

    // Save data to localStorage
    function saveData() {
      const data = {
        subtitle: subtitle,
        activities: activities
      };
      localStorage.setItem('roadtripActivities', JSON.stringify(data));
    }

    // Edit subtitle
    function editSubtitle() {
      const subtitleEl = document.getElementById('subtitle');
      const currentText = subtitleEl.textContent;
      const input = document.createElement('input');
      input.type = 'text';
      input.value = currentText;
      input.style.cssText = `
        font-family: 'Caveat', cursive;
        font-size: 1.8rem;
        color: var(--road-gray);
        border: 3px solid var(--sunset-orange);
        border-radius: 8px;
        padding: 0.5rem 1rem;
        background: white;
        text-align: center;
        width: 400px;
        max-width: 90vw;
      `;
      
      input.onblur = function() {
        const newText = input.value.trim() || 'Plan Your Perfect Journey';
        subtitle = newText;
        subtitleEl.textContent = newText;
        saveData();
      };
      
      input.onkeydown = function(e) {
        if (e.key === 'Enter') {
          input.blur();
        } else if (e.key === 'Escape') {
          subtitleEl.textContent = currentText;
        }
      };
      
      subtitleEl.textContent = '';
      subtitleEl.appendChild(input);
      input.focus();
      input.select();
    }

    // Calculate end time based on start time and duration
    function calculateEndTime(startDateTime, durationHours) {
      const start = new Date(startDateTime);
      const end = new Date(start.getTime() + durationHours * 60 * 60 * 1000);
      // Return in local datetime format (YYYY-MM-DDTHH:mm)
      const year = end.getFullYear();
      const month = String(end.getMonth() + 1).padStart(2, '0');
      const day = String(end.getDate()).padStart(2, '0');
      const hours = String(end.getHours()).padStart(2, '0');
      const minutes = String(end.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    // Format date for display - Fixed to use local date string parsing
    function formatDate(dateString) {
      // Parse as local date to avoid timezone issues
      const [year, month, day] = dateString.split('-');
      const date = new Date(year, month - 1, day);
      return date.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }

    // Format time for display
    function formatTime(dateString) {
      const date = new Date(dateString);
      return date.toLocaleTimeString('en-US', { 
        hour: 'numeric', 
        minute: '2-digit',
        hour12: true 
      });
    }

    // Get Google Maps directions URL
    function getDirectionsUrl(address) {
      const encodedAddress = encodeURIComponent(address);
      return `https://www.google.com/maps/dir/?api=1&destination=${encodedAddress}`;
    }

    // Open map view with all activities
    function openMapView() {
      let activitiesToMap = activities;
      
      // If filtered, only show filtered activities
      if (filterDate) {
        activitiesToMap = activities.filter(a => a.startDateTime.startsWith(filterDate));
      }
      
      if (activitiesToMap.length === 0) {
        showNotification('No activities to show on map', 'error');
        return;
      }
      
      // Build Google Maps URL with directions
      // Google Maps supports up to 10 waypoints, so we'll use the first 10 activities
      const maxWaypoints = 9; // origin + 9 waypoints + destination = 11 total stops
      const limitedActivities = activitiesToMap.slice(0, maxWaypoints + 1);
      
      let mapUrl = 'https://www.google.com/maps/dir/?api=1';
      
      // Set origin (first activity)
      const origin = encodeURIComponent(limitedActivities[0].address);
      mapUrl += `&origin=${origin}`;
      
      // Set destination (last activity in our limited set)
      const destination = encodeURIComponent(limitedActivities[limitedActivities.length - 1].address);
      mapUrl += `&destination=${destination}`;
      
      // Set waypoints (middle activities)
      if (limitedActivities.length > 2) {
        const waypoints = limitedActivities.slice(1, -1).map(a => encodeURIComponent(a.address)).join('|');
        mapUrl += `&waypoints=${waypoints}`;
      }
      
      // Open in new tab
      window.open(mapUrl, '_blank');
      
      // Show notification if we had to limit activities
      if (activitiesToMap.length > maxWaypoints + 1) {
        showNotification(`Showing first ${maxWaypoints + 1} activities on map (Google Maps limit)`, 'info');
      }
    }

    // Open add modal
    function openAddModal() {
      editingId = null;
      document.getElementById('modalTitle').textContent = 'Add Activity';
      // Reset all form fields
      document.getElementById('activityType').value = 'driving';
      document.getElementById('activityName').value = '';
      document.getElementById('address').value = '';
      document.getElementById('duration').value = '';
      document.getElementById('notes').value = '';
      
      // Set start time to last activity's end time, or current time if no activities
      let defaultStartTime;
      if (activities.length > 0) {
        // Get the last activity (already sorted)
        const lastActivity = activities[activities.length - 1];
        defaultStartTime = lastActivity.endDateTime;
      } else {
        // No activities yet, use current time rounded to nearest 15 minutes
        const now = new Date();
        now.setMinutes(Math.round(now.getMinutes() / 15) * 15);
        now.setSeconds(0);
        now.setMilliseconds(0);
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        defaultStartTime = `${year}-${month}-${day}T${hours}:${minutes}`;
      }
      
      document.getElementById('startDateTime').value = defaultStartTime;
      document.getElementById('activityModal').classList.add('active');
    }

    // Open edit modal
    function openEditModal(id) {
      editingId = id;
      const activity = activities.find(a => a.id === id);
      
      document.getElementById('modalTitle').textContent = 'Edit Activity';
      document.getElementById('activityType').value = activity.type;
      document.getElementById('activityName').value = activity.name;
      document.getElementById('address').value = activity.address;
      document.getElementById('startDateTime').value = activity.startDateTime;
      document.getElementById('duration').value = activity.duration;
      document.getElementById('notes').value = activity.notes || '';
      
      document.getElementById('activityModal').classList.add('active');
    }

    // Close modal
    function closeModal() {
      document.getElementById('activityModal').classList.remove('active');
      editingId = null;
    }

    // Save activity - FIXED
    function saveActivity() {
      const type = document.getElementById('activityType').value;
      const name = document.getElementById('activityName').value;
      const address = document.getElementById('address').value;
      const startDateTime = document.getElementById('startDateTime').value;
      const duration = parseFloat(document.getElementById('duration').value);
      const notes = document.getElementById('notes').value;
      
      // Validate required fields
      if (!name || !address || !startDateTime || !duration) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      const endDateTime = calculateEndTime(startDateTime, duration);
      
      const activity = {
        id: editingId || Date.now(),
        type,
        name,
        address,
        startDateTime,
        endDateTime,
        duration,
        notes
      };
      
      if (editingId) {
        const index = activities.findIndex(a => a.id === editingId);
        activities[index] = activity;
      } else {
        activities.push(activity);
      }
      
      activities.sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
      
      saveData();
      renderTimeline();
      closeModal();
    }

    // Delete activity
    function deleteActivity(id) {
      const confirmDelete = true; // Simplified - could add custom modal later
      if (confirmDelete) {
        activities = activities.filter(a => a.id !== id);
        saveData();
        renderTimeline();
      }
    }

    // Group activities by day
    function groupByDay(activitiesToGroup) {
      const grouped = {};
      
      activitiesToGroup.forEach(activity => {
        const date = activity.startDateTime.split('T')[0];
        if (!grouped[date]) {
          grouped[date] = [];
        }
        grouped[date].push(activity);
      });
      
      return grouped;
    }

    // Render timeline
    function renderTimeline() {
      const timeline = document.getElementById('timeline');
      
      let activitiesToRender = activities;
      if (filterDate) {
        activitiesToRender = activities.filter(a => a.startDateTime.startsWith(filterDate));
      }
      
      if (activitiesToRender.length === 0) {
        timeline.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üó∫Ô∏è</div>
            <h3>No Activities Yet</h3>
            <p>Start planning your adventure by adding your first activity!</p>
          </div>
        `;
        return;
      }
      
      const groupedActivities = groupByDay(activitiesToRender);
      
      let html = '';
      Object.keys(groupedActivities).sort().forEach((date, dayIndex) => {
        const dayActivities = groupedActivities[date];
        
        html += `
          <div class="day-section" style="animation-delay: ${dayIndex * 0.1}s">
            <div class="day-header">${formatDate(date)}</div>
        `;
        
        dayActivities.forEach((activity, actIndex) => {
          const typeEmoji = {
            driving: 'üöó',
            eating: 'üçΩÔ∏è',
            sleeping: 'üõèÔ∏è',
            other: 'üéØ'
          };
          
          html += `
            <div class="activity-card ${activity.type}" style="animation-delay: ${(dayIndex * 0.1) + (actIndex * 0.05)}s">
              <div class="activity-header">
                <div class="activity-title">${typeEmoji[activity.type]} ${activity.name}</div>
                <div class="activity-type ${activity.type}">${activity.type}</div>
              </div>
              
              <div class="activity-time">
                ${formatTime(activity.startDateTime)} 
                <span class="time-arrow">‚Üí</span> 
                ${formatTime(activity.endDateTime)}
                <span style="color: var(--desert-sand); margin-left: 1rem;">(${activity.duration} hrs)</span>
              </div>
              
              <div class="activity-details">
                <a href="${getDirectionsUrl(activity.address)}" 
                   target="_blank" 
                   class="address-link">
                  üìç ${activity.address}
                </a>
                ${activity.notes ? `<p style="margin-top: 1rem;"><strong>Notes:</strong> ${activity.notes}</p>` : ''}
              </div>
              
              <div class="activity-actions">
                <button class="btn-secondary btn-small" onclick="openEditModal(${activity.id})">
                  Edit
                </button>
                <button class="btn-danger btn-small" onclick="deleteActivity(${activity.id})">
                  Delete
                </button>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
      });
      
      timeline.innerHTML = html;
    }

    // Filter activities
    function filterActivities() {
      filterDate = document.getElementById('filterDate').value;
      renderTimeline();
    }

    // Clear filter
    function clearFilter() {
      filterDate = null;
      document.getElementById('filterDate').value = '';
      renderTimeline();
    }

    // Export data
    function exportData() {
      const data = JSON.stringify({ subtitle, activities }, null, 2);
      document.getElementById('exportJSON').value = data;
      document.getElementById('exportModal').classList.add('active');
    }

    // Close export modal
    function closeExportModal() {
      document.getElementById('exportModal').classList.remove('active');
    }

    // Copy to clipboard
    function copyToClipboard() {
      const textarea = document.getElementById('exportJSON');
      textarea.select();
      document.execCommand('copy');
      
      // Visual feedback instead of alert
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '‚úì Copied!';
      btn.style.background = 'linear-gradient(135deg, var(--map-green), var(--sky-blue))';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
      }, 2000);
    }

    // Download JSON file
    function downloadJSON() {
      const data = document.getElementById('exportJSON').value;
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `roadtrip-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Open import modal
    function openImportModal() {
      document.getElementById('importJSON').value = '';
      document.getElementById('importModal').classList.add('active');
    }

    // Close import modal
    function closeImportModal() {
      document.getElementById('importModal').classList.remove('active');
    }

    // Import data
    function importData() {
      try {
        const jsonText = document.getElementById('importJSON').value;
        const data = JSON.parse(jsonText);
        
        if (data.activities && Array.isArray(data.activities)) {
          activities = data.activities;
          subtitle = data.subtitle || 'Plan Your Perfect Journey';
          document.getElementById('subtitle').textContent = subtitle;
          activities.sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
          saveData();
          renderTimeline();
          closeImportModal();
          
          // Visual feedback
          showNotification('Trip data imported successfully!', 'success');
        } else {
          showNotification('Invalid JSON format. Please ensure it has an "activities" array.', 'error');
        }
      } catch (error) {
        showNotification('Error parsing JSON: ' + error.message, 'error');
      }
    }

    // Clear all data
    function clearAllData() {
      activities = [];
      subtitle = 'Plan Your Perfect Journey';
      document.getElementById('subtitle').textContent = subtitle;
      saveData();
      renderTimeline();
      toggleMenu();
      showNotification('All activities cleared', 'success');
    }

    // Show notification toast
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Trigger animation
      setTimeout(() => notification.classList.add('show'), 10);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Initialize
    loadUser();
    initGoogleSignIn();
    loadData();
  </script>
</body>
</html>